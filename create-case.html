<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create New Case - AI Advocates</title>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --primary: #4c4cdd;
        --primary-dark: #3d3cb8;
        --primary-light: #6666e3;
        --secondary: #10b981;
        --background: #f8fafc;
        --surface: #ffffff;
        --text-primary: #1e293b;
        --text-secondary: #64748b;
        --text-muted: #94a3b8;
        --border: #e2e8f0;
        --border-active: #4c4cdd;
        --success: #10b981;
        --error: #ef4444;
        --warning: #f59e0b;
        --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      }

      body {
        font-family:
          "Inter",
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          sans-serif;
        background: var(--background);
        color: var(--text-primary);
        line-height: 1.6;
        min-height: 100vh;
        padding-top: 80px;
        padding-bottom: 80px;
      }

      .app-container {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      /* Header */
      .header {
        background: var(--surface);
        border-bottom: 1px solid var(--border);
        padding: 1rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: var(--shadow);
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 100;
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .menu-toggle {
        background: none;
        border: none;
        font-size: 1.25rem;
        color: var(--text-secondary);
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 6px;
      }

      .menu-toggle:hover {
        background: var(--background);
      }

      .logo-container {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .logo-icon {
        width: 32px;
        height: 32px;
        background: var(--primary);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1rem;
      }

      .logo-text {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--primary);
      }

      .header-right {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .notification-icon {
        position: relative;
        background: none;
        border: none;
        font-size: 1.125rem;
        color: var(--text-secondary);
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 6px;
      }

      .notification-badge {
        position: absolute;
        top: 0.25rem;
        right: 0.25rem;
        background: var(--error);
        color: white;
        font-size: 0.75rem;
        font-weight: 600;
        border-radius: 50%;
        width: 18px;
        height: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .user-avatar {
        width: 32px;
        height: 32px;
        background: var(--primary-light);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        cursor: pointer;
      }

      /* Main Content */
      .main-content {
        flex: 1;
        padding: 1.5rem;
        max-width: 1200px;
        margin: 0 auto;
        width: 100%;
      }

      .page-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 2rem;
      }

      .page-title-section h1 {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .page-subtitle {
        color: var(--text-secondary);
        font-size: 0.875rem;
      }

      /* Breadcrumb */
      .breadcrumb {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin: 0.75rem 0 1.5rem 0;
        font-size: 0.875rem;
      }

      .breadcrumb-item {
        color: var(--text-secondary);
        text-decoration: none;
        transition: color 0.2s ease;
        display: flex;
        align-items: center;
        gap: 0.25rem;
      }

      .breadcrumb-item:hover {
        color: var(--primary);
      }

      .breadcrumb-item.active {
        color: var(--text-primary);
        font-weight: 500;
      }

      .breadcrumb-separator {
        color: var(--text-muted);
        font-size: 0.75rem;
      }

      /* Form Styles */
      .form-container {
        background: var(--surface);
        border-radius: 12px;
        border: 1px solid var(--border);
        box-shadow: var(--shadow-lg);
        overflow: hidden;
      }

      .form-section {
        padding: 2rem;
        border-bottom: 1px solid var(--border);
      }

      .form-section:last-child {
        border-bottom: none;
      }

      .section-header {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid var(--border);
      }

      .section-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--text-primary);
      }

      .section-icon {
        color: var(--primary);
        font-size: 1.125rem;
      }

      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .form-label {
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--text-primary);
      }

      .required {
        color: var(--error);
      }

      .form-input {
        padding: 0.75rem;
        border: 1px solid var(--border);
        border-radius: 8px;
        font-size: 0.875rem;
        background: var(--surface);
        transition: border-color 0.2s ease;
      }

      .form-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
      }

      .form-select {
        padding: 0.75rem;
        border: 1px solid var(--border);
        border-radius: 8px;
        font-size: 0.875rem;
        background: var(--surface);
        cursor: pointer;
      }

      .form-select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
      }

      .form-textarea {
        padding: 0.75rem;
        border: 1px solid var(--border);
        border-radius: 8px;
        font-size: 0.875rem;
        background: var(--surface);
        resize: vertical;
        min-height: 100px;
      }

      .form-textarea:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
      }

      .checkbox-group {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-top: 1rem;
        padding: 0.75rem;
        background: var(--background);
        border-radius: 8px;
      }

      .checkbox-group input[type="checkbox"] {
        width: 18px;
        height: 18px;
        accent-color: var(--primary);
      }

      .checkbox-label {
        font-size: 0.875rem;
        color: var(--text-secondary);
      }

      .file-upload {
        position: relative;
        display: inline-block;
        cursor: pointer;
        width: 100%;
      }

      .file-upload input[type="file"] {
        position: absolute;
        opacity: 0;
        width: 100%;
        height: 100%;
        cursor: pointer;
      }

      .file-upload-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 1rem;
        background: var(--background);
        border: 2px dashed var(--border);
        border-radius: 8px;
        font-size: 0.875rem;
        color: var(--text-primary);
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .file-upload-btn:hover {
        border-color: var(--primary);
        background: rgba(79, 70, 229, 0.05);
      }

      /* Action Buttons */
      .form-actions {
        padding: 2rem;
        background: var(--background);
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
        border-top: 1px solid var(--border);
      }

      .btn {
        padding: 0.75rem 2rem;
        border: none;
        border-radius: 8px;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .btn-primary {
        background: var(--primary);
        color: white;
      }

      .btn-primary:hover {
        background: var(--primary-dark);
        transform: translateY(-1px);
      }

      .btn-secondary {
        background: var(--surface);
        color: var(--text-primary);
        border: 1px solid var(--border);
      }

      .btn-secondary:hover {
        background: var(--background);
        border-color: var(--text-muted);
      }

      .btn-success {
        background: var(--success);
        color: white;
        border: 1px solid var(--success);
      }

      .btn-success:hover {
        background: #059669;
        border-color: #059669;
      }

      /* Dynamic Lists */
      .dynamic-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .list-item {
        background: var(--background);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 1.5rem;
        position: relative;
      }

      .list-item-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid var(--border);
      }

      .list-item-title {
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .remove-item-btn {
        background: var(--error);
        color: white;
        border: none;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.75rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.25rem;
      }

      .remove-item-btn:hover {
        background: #dc2626;
      }

      .add-item-btn {
        background: var(--primary);
        color: white;
        border: none;
        padding: 0.75rem 1rem;
        border-radius: 6px;
        font-size: 0.875rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-top: 1rem;
      }

      .add-item-btn:hover {
        background: var(--primary-dark);
      }

      .advocate-role-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 500;
      }

      .advocate-role-badge.senior {
        background: rgba(139, 92, 246, 0.1);
        color: #8b5cf6;
      }

      .advocate-role-badge.junior {
        background: rgba(59, 130, 246, 0.1);
        color: #3b82f6;
      }

      .document-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.75rem;
        background: var(--background);
        border: 1px solid var(--border);
        border-radius: 6px;
        margin-top: 0.5rem;
      }

      .document-info {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .document-type-select {
        padding: 0.5rem;
        border: 1px solid var(--border);
        border-radius: 4px;
        font-size: 0.75rem;
        background: var(--surface);
        margin-left: 0.5rem;
      }

      .article-link-preview {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-top: 0.5rem;
        padding: 0.5rem;
        background: var(--background);
        border-radius: 4px;
        font-size: 0.8rem;
      }

      .article-link-preview a {
        color: var(--primary);
        text-decoration: none;
      }

      .article-link-preview a:hover {
        text-decoration: underline;
      }

      .article-type-badge {
        padding: 0.25rem 0.5rem;
        border-radius: 12px;
        font-size: 0.7rem;
        font-weight: 500;
        background: rgba(79, 70, 229, 0.1);
        color: var(--primary);
      }

      .reference-sources-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 0.5rem;
        margin-top: 0.75rem;
      }

      .reference-source-item {
        padding: 0.5rem;
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 4px;
        font-size: 0.8rem;
      }

      .url-input-group {
        position: relative;
      }

      .url-validate-btn {
        position: absolute;
        right: 0.5rem;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: var(--text-muted);
        cursor: pointer;
        padding: 0.25rem;
      }

      .url-validate-btn:hover {
        color: var(--primary);
      }

      .url-validate-btn.valid {
        color: var(--success);
      }

      .url-validate-btn.invalid {
        color: var(--error);
      }

      /* Success Notification */
      .success-notification {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: var(--surface);
        border: 2px solid var(--success);
        border-radius: 12px;
        padding: 2rem;
        box-shadow: var(--shadow-xl);
        z-index: 1000;
        text-align: center;
        min-width: 400px;
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.9);
        transition: all 0.3s ease;
      }

      .success-notification.show {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }

      .success-notification .success-icon {
        width: 60px;
        height: 60px;
        background: var(--success);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        color: white;
        font-size: 1.5rem;
      }

      .success-notification .success-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
      }

      .success-notification .success-message {
        color: var(--text-secondary);
        margin-bottom: 1.5rem;
        line-height: 1.6;
      }

      .success-notification .success-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
      }

      .notification-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .notification-overlay.show {
        opacity: 1;
        visibility: visible;
      }

      /* Loading State */
      .btn.loading {
        position: relative;
        color: transparent;
        pointer-events: none;
      }

      .btn.loading::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 20px;
        height: 20px;
        border: 2px solid transparent;
        border-top: 2px solid currentColor;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        color: white;
      }

      /* Side Menu */
      .side-menu {
        position: fixed;
        top: 0;
        left: -300px;
        width: 300px;
        height: 100vh;
        background: var(--surface);
        border-right: 1px solid var(--border);
        box-shadow: var(--shadow-xl);
        z-index: 1000;
        transition: left 0.3s ease;
        overflow-y: auto;
      }

      .side-menu.open {
        left: 0;
      }

      .side-menu-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .side-menu-overlay.show {
        opacity: 1;
        visibility: visible;
      }

      .side-menu-header {
        padding: 1.5rem;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .side-menu-logo {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .side-menu-close {
        background: none;
        border: none;
        font-size: 1.25rem;
        color: var(--text-secondary);
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 6px;
      }

      .side-menu-close:hover {
        background: var(--background);
      }

      .side-menu-subtitle {
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin-top: 0.25rem;
      }

      .side-menu-nav {
        padding: 1rem 0;
      }

      .side-menu-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.75rem 1.5rem;
        color: var(--text-primary);
        text-decoration: none;
        transition: background-color 0.2s ease;
        border: none;
        background: none;
        width: 100%;
        text-align: left;
        cursor: pointer;
        font-size: 1rem;
      }

      .side-menu-item:hover {
        background: var(--background);
      }

      .side-menu-item.active {
        background: rgba(79, 70, 229, 0.1);
        color: var(--primary);
      }

      .side-menu-item.logout {
        color: var(--error);
        border-top: 1px solid var(--border);
        margin-top: 1rem;
      }

      .side-menu-item.logout:hover {
        background: rgba(239, 68, 68, 0.1);
      }

      .side-menu-icon {
        width: 20px;
        text-align: center;
      }

      /* Bottom Navigation */
      .bottom-nav {
        background: var(--surface);
        border-top: 1px solid var(--border);
        padding: 0.75rem;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 100;
      }

      .nav-items {
        display: flex;
        justify-content: space-around;
        max-width: 600px;
        margin: 0 auto;
      }

      .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.25rem;
        text-decoration: none;
        color: var(--text-secondary);
        font-size: 0.75rem;
        font-weight: 500;
        transition: color 0.2s ease;
      }

      .nav-item.active {
        color: var(--primary);
      }

      .nav-item i {
        font-size: 1.25rem;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .main-content {
          padding: 1rem;
        }

        .form-section {
          padding: 1.5rem;
        }

        .form-grid {
          grid-template-columns: 1fr;
        }

        .page-header {
          flex-direction: column;
          gap: 1rem;
          align-items: stretch;
        }

        .form-actions {
          flex-direction: column;
          padding: 1.5rem;
        }

        .btn {
          width: 100%;
          justify-content: center;
        }

        .section-title {
          font-size: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Side Menu Overlay -->
    <div class="side-menu-overlay" id="sideMenuOverlay"></div>

    <!-- Side Menu -->
    <div class="side-menu" id="sideMenu">
      <div class="side-menu-header">
        <div class="side-menu-logo">
          <div class="logo-icon">
            <i class="fas fa-balance-scale"></i>
          </div>
          <div>
            <span class="logo-text">AI Advocates</span>
            <div class="side-menu-subtitle">Legal Practice Management</div>
          </div>
        </div>
        <button class="side-menu-close" onclick="closeSideMenu()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <nav class="side-menu-nav">
        <a href="home.html" class="side-menu-item">
          <i class="fas fa-home side-menu-icon"></i>
          Home
        </a>
        <a href="team.html" class="side-menu-item">
          <i class="fas fa-users side-menu-icon"></i>
          My Team
        </a>
        <a href="cases.html" class="side-menu-item active">
          <i class="fas fa-file-alt side-menu-icon"></i>
          Cases
        </a>
        <a href="calendar.html" class="side-menu-item">
          <i class="fas fa-calendar side-menu-icon"></i>
          Calendar
        </a>
        <a href="more.html" class="side-menu-item">
          <i class="fas fa-th side-menu-icon"></i>
          More
        </a>
        <button class="side-menu-item logout" onclick="logoutFromApp()">
          <i class="fas fa-sign-out-alt side-menu-icon"></i>
          Log Out
        </button>
      </nav>
    </div>

    <div class="app-container">
      <!-- Header -->
      <div class="header">
        <div class="header-left">
          <button class="menu-toggle" onclick="openSideMenu()">
            <i class="fas fa-bars"></i>
          </button>
          <div class="logo-container">
            <div class="logo-icon">
              <i class="fas fa-balance-scale"></i>
            </div>
            <span class="logo-text">AI Advocates</span>
          </div>
        </div>
        <div class="header-right">
          <button class="notification-icon">
            <i class="fas fa-bell"></i>
            <span class="notification-badge">3</span>
          </button>

          <button class="notification-icon" onclick="logoutFromApp()">
            <i class="fas fa-sign-out-alt"></i>
          </button>
        </div>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <!-- Page Header -->
        <div class="page-header">
          <div class="page-title-section">
            <h1 id="pageTitle">
              <i class="fas fa-plus-circle" id="pageIcon"></i>
              <span id="pageTitleText">Create New Case</span>
            </h1>

            <!-- Breadcrumb -->
            <nav class="breadcrumb">
              <a href="home.html" class="breadcrumb-item">
                <i class="fas fa-home"></i>
                Home
              </a>
              <span class="breadcrumb-separator">
                <i class="fas fa-chevron-right"></i>
              </span>
              <a href="cases.html" class="breadcrumb-item">
                <i class="fas fa-file-alt"></i>
                Cases
              </a>
              <span class="breadcrumb-separator">
                <i class="fas fa-chevron-right"></i>
              </span>
              <span class="breadcrumb-item active">
                <i class="fas fa-plus" id="breadcrumbIcon"></i>
                <span id="breadcrumbText">Create Case</span>
              </span>
            </nav>

            <p class="page-subtitle" id="pageSubtitle">
              Create a new legal case with comprehensive details
            </p>
          </div>
        </div>

        <!-- Case Creation Form -->
        <div class="form-container">
          <form id="caseForm">
            <!-- Section 1: Case Basics -->
            <div class="form-section">
              <div class="section-header">
                <i class="fas fa-folder section-icon"></i>
                <span class="section-title">Case Basics</span>
              </div>
              <div class="form-grid">
                <div class="form-group">
                  <label class="form-label"
                    >Case Title <span class="required">*</span></label
                  >
                  <input
                    type="text"
                    class="form-input"
                    name="case_title"
                    placeholder="e.g., State vs. Ramesh Sharma"
                    required
                  />
                </div>
                <div class="form-group">
                  <label class="form-label"
                    >Case Type <span class="required">*</span></label
                  >
                  <select class="form-select" name="case_type" required>
                    <option value="">Select Case Type</option>
                    <option value="Criminal">Criminal</option>
                    <option value="Civil">Civil</option>
                    <option value="Matrimonial">Matrimonial</option>
                    <option value="Corporate">Corporate</option>
                    <option value="Property">Property</option>
                    <option value="Labor">Labor</option>
                    <option value="Tax">Tax</option>
                    <option value="Family">Family</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label"
                    >Court Name <span class="required">*</span></label
                  >
                  <input
                    type="text"
                    class="form-input"
                    name="court_name"
                    placeholder="e.g., Delhi District Court"
                    required
                  />
                </div>
                <div class="form-group">
                  <label class="form-label">Judge Name</label>
                  <input
                    type="text"
                    class="form-input"
                    name="judge_name"
                    placeholder="Hon'ble Justice Name"
                  />
                </div>
                <div class="form-group">
                  <label class="form-label">Case Number</label>
                  <input
                    type="text"
                    class="form-input"
                    name="case_number"
                    placeholder="e.g., CC/1234/2024"
                  />
                </div>
                <div class="form-group">
                  <label class="form-label"
                    >Filing Date <span class="required">*</span></label
                  >
                  <input
                    type="date"
                    class="form-input"
                    name="filing_date"
                    required
                  />
                </div>
                <div class="form-group">
                  <label class="form-label">Status</label>
                  <select class="form-select" name="status">
                    <option value="Active">Active</option>
                    <option value="Disposed">Disposed</option>
                    <option value="Appeal Filed">Appeal Filed</option>
                    <option value="Pending">Pending</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">Jurisdiction</label>
                  <input
                    type="text"
                    class="form-input"
                    name="jurisdiction"
                    placeholder="e.g., Delhi East"
                  />
                </div>
              </div>
            </div>

            <!-- Section 2: Parties Involved -->
            <div class="form-section">
              <div class="section-header">
                <i class="fas fa-users section-icon"></i>
                <span class="section-title">Parties Involved</span>
              </div>

              <!-- Petitioners -->
              <div style="margin-bottom: 2rem">
                <h4
                  style="
                    font-size: 1rem;
                    font-weight: 600;
                    margin-bottom: 1rem;
                    color: var(--text-primary);
                  "
                >
                  <i class="fas fa-user"></i> Petitioners
                </h4>
                <div class="dynamic-list" id="petitionersList">
                  <div class="list-item">
                    <div class="list-item-header">
                      <span class="list-item-title">
                        <i class="fas fa-user"></i>
                        Petitioner 1
                      </span>
                    </div>
                    <div class="form-grid">
                      <div class="form-group">
                        <label class="form-label"
                          >Name <span class="required">*</span></label
                        >
                        <input
                          type="text"
                          class="form-input"
                          name="petitioners[0][name]"
                          required
                        />
                      </div>
                      <div class="form-group">
                        <label class="form-label">Phone</label>
                        <input
                          type="tel"
                          class="form-input"
                          name="petitioners[0][phone]"
                        />
                      </div>
                      <div class="form-group">
                        <label class="form-label">Email</label>
                        <input
                          type="email"
                          class="form-input"
                          name="petitioners[0][email]"
                        />
                      </div>
                      <div class="form-group">
                        <label class="form-label">Type</label>
                        <select class="form-select" name="petitioners[0][type]">
                          <option value="Individual">Individual</option>
                          <option value="Company">Company</option>
                          <option value="Organization">Organization</option>
                          <option value="Government">Government</option>
                        </select>
                      </div>
                      <div class="form-group" style="grid-column: 1 / -1">
                        <label class="form-label">Address</label>
                        <textarea
                          class="form-textarea"
                          name="petitioners[0][address]"
                          placeholder="Complete address"
                        ></textarea>
                      </div>
                    </div>
                  </div>
                </div>
                <button
                  type="button"
                  class="add-item-btn"
                  id="addPetitionerBtn"
                >
                  <i class="fas fa-plus"></i>
                  Add Another Petitioner
                </button>
              </div>

              <!-- Respondents -->
              <div>
                <h4
                  style="
                    font-size: 1rem;
                    font-weight: 600;
                    margin-bottom: 1rem;
                    color: var(--text-primary);
                  "
                >
                  <i class="fas fa-user-tie"></i> Respondents
                </h4>
                <div class="dynamic-list" id="respondentsList">
                  <div class="list-item">
                    <div class="list-item-header">
                      <span class="list-item-title">
                        <i class="fas fa-user-tie"></i>
                        Respondent 1
                      </span>
                    </div>
                    <div class="form-grid">
                      <div class="form-group">
                        <label class="form-label"
                          >Name <span class="required">*</span></label
                        >
                        <input
                          type="text"
                          class="form-input"
                          name="respondents[0][name]"
                          required
                        />
                      </div>
                      <div class="form-group">
                        <label class="form-label">Phone</label>
                        <input
                          type="tel"
                          class="form-input"
                          name="respondents[0][phone]"
                        />
                      </div>
                      <div class="form-group">
                        <label class="form-label">Email</label>
                        <input
                          type="email"
                          class="form-input"
                          name="respondents[0][email]"
                        />
                      </div>
                      <div class="form-group">
                        <label class="form-label">Type</label>
                        <select class="form-select" name="respondents[0][type]">
                          <option value="Individual">Individual</option>
                          <option value="Company">Company</option>
                          <option value="Organization">Organization</option>
                          <option value="Government">Government</option>
                        </select>
                      </div>
                      <div class="form-group" style="grid-column: 1 / -1">
                        <label class="form-label">Address</label>
                        <textarea
                          class="form-textarea"
                          name="respondents[0][address]"
                          placeholder="Complete address"
                        ></textarea>
                      </div>
                    </div>
                  </div>
                </div>
                <button
                  type="button"
                  class="add-item-btn"
                  id="addRespondentBtn"
                >
                  <i class="fas fa-plus"></i>
                  Add Another Respondent
                </button>
              </div>
            </div>

            <!-- Section 3: Client Details -->
            <div class="form-section">
              <div class="section-header">
                <i class="fas fa-user section-icon"></i>
                <span class="section-title">Client Details</span>
              </div>
              <div class="form-grid">
                <div class="form-group">
                  <label class="form-label">Client Name</label>
                  <input type="text" class="form-input" name="client_name" />
                </div>
                <div class="form-group">
                  <label class="form-label">Client Type</label>
                  <select class="form-select" name="client_type">
                    <option value="">Select Type</option>
                    <option value="Individual">Individual</option>
                    <option value="Company">Company</option>
                    <option value="Organization">Organization</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">Client Phone</label>
                  <input type="tel" class="form-input" name="client_phone" />
                </div>
                <div class="form-group">
                  <label class="form-label">Client Email</label>
                  <input type="email" class="form-input" name="client_email" />
                </div>
              </div>
            </div>

            <!-- Section 4: Legal Sections & Acts -->
            <div class="form-section">
              <div class="section-header">
                <i class="fas fa-gavel section-icon"></i>
                <span class="section-title">Legal Sections & Acts</span>
              </div>
              <div class="form-grid">
                <div class="form-group">
                  <label class="form-label">IPC Sections</label>
                  <input
                    type="text"
                    class="form-input"
                    name="ipc_sections"
                    placeholder="e.g., IPC 420, IPC 406"
                  />
                </div>
                <div class="form-group">
                  <label class="form-label">Acts Involved</label>
                  <input
                    type="text"
                    class="form-input"
                    name="acts"
                    placeholder="e.g., CrPC, CPC, Indian Evidence Act"
                  />
                </div>
                <div class="form-group" style="grid-column: 1 / -1">
                  <label class="form-label">Custom Tags</label>
                  <input
                    type="text"
                    class="form-input"
                    name="custom_tags"
                    placeholder="e.g., Bail, Interim Order, Notice Served"
                  />
                </div>
              </div>
            </div>

            <!-- Section 5: Hearing & Scheduling -->
            <div class="form-section">
              <div class="section-header">
                <i class="fas fa-calendar section-icon"></i>
                <span class="section-title">Hearing & Scheduling</span>
              </div>
              <div class="form-grid">
                <div class="form-group">
                  <label class="form-label">Next Hearing Date</label>
                  <input
                    type="date"
                    class="form-input"
                    name="next_hearing_date"
                  />
                </div>
                <div class="form-group">
                  <label class="form-label">Courtroom Number</label>
                  <input
                    type="text"
                    class="form-input"
                    name="courtroom_number"
                  />
                </div>
                <div class="form-group">
                  <label class="form-label">Hearing Purpose</label>
                  <select class="form-select" name="hearing_purpose">
                    <option value="">Select Purpose</option>
                    <option value="For Arguments">For Arguments</option>
                    <option value="For Evidence">For Evidence</option>
                    <option value="Order Reserved">Order Reserved</option>
                    <option value="Final Hearing">Final Hearing</option>
                    <option value="Bail Application">Bail Application</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">Assigned Judge</label>
                  <input type="text" class="form-input" name="assigned_judge" />
                </div>
              </div>
              <div class="checkbox-group">
                <input
                  type="checkbox"
                  id="auto_reminder"
                  name="auto_reminder"
                />
                <label for="auto_reminder" class="checkbox-label"
                  >Enable auto reminder for hearing dates</label
                >
              </div>
            </div>

            <!-- Section 6: Documents -->
            <div class="form-section">
              <div class="section-header">
                <i class="fas fa-file section-icon"></i>
                <span class="section-title">Documents</span>
              </div>

              <div class="form-grid">
                <div class="form-group" style="grid-column: 1 / -1">
                  <label class="form-label">Upload Documents</label>
                  <div class="file-upload">
                    <input
                      type="file"
                      name="documents"
                      multiple
                      accept=".pdf,.doc,.docx,.jpg,.png,.jpeg"
                      id="documentUpload"
                    />
                    <div class="file-upload-btn">
                      <i class="fas fa-upload"></i>
                      Choose Files (PDF, DOC, DOCX, JPG, PNG)
                    </div>
                  </div>
                  <small
                    style="
                      color: var(--text-muted);
                      margin-top: 0.75rem;
                      display: block;
                    "
                  >
                    Upload case-related documents. You can categorize each
                    document after selection.
                  </small>
                </div>
              </div>

              <!-- Document Categories Guide -->
              <div
                style="
                  margin: 1.5rem 0;
                  padding: 1rem;
                  background: var(--background);
                  border-radius: 8px;
                "
              >
                <h5
                  style="
                    font-size: 0.875rem;
                    font-weight: 600;
                    margin-bottom: 0.75rem;
                    color: var(--text-primary);
                  "
                >
                  <i class="fas fa-info-circle"></i> Document Categories
                </h5>
                <div
                  style="
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 0.75rem;
                    font-size: 0.8rem;
                    color: var(--text-secondary);
                  "
                >
                  <div><strong>FIR:</strong> First Information Report</div>
                  <div>
                    <strong>Petition:</strong> Main case petition/plaint
                  </div>
                  <div>
                    <strong>Evidence:</strong> Supporting evidence documents
                  </div>
                  <div>
                    <strong>Notice:</strong> Legal notices served/received
                  </div>
                  <div><strong>Order:</strong> Court orders and judgments</div>
                  <div><strong>Affidavit:</strong> Sworn statements</div>
                  <div><strong>Contract:</strong> Agreements and contracts</div>
                  <div>
                    <strong>Identity:</strong> ID proofs and certificates
                  </div>
                  <div>
                    <strong>Financial:</strong> Bank statements, receipts
                  </div>
                  <div><strong>Other:</strong> Miscellaneous documents</div>
                </div>
              </div>

              <!-- Uploaded Documents List -->
              <div id="uploadedDocumentsList" style="margin-top: 1.5rem"></div>
            </div>

            <!-- Section 6.5: Reference Articles -->
            <div class="form-section">
              <div class="section-header">
                <i class="fas fa-link section-icon"></i>
                <span class="section-title">Reference Articles & Links</span>
              </div>

              <div style="margin-bottom: 1.5rem">
                <p
                  style="
                    color: var(--text-secondary);
                    font-size: 0.875rem;
                    margin-bottom: 1rem;
                  "
                >
                  Select relevant articles from your article database or add new
                  ones.
                </p>
                <button
                  type="button"
                  onclick="window.open('articles.html', '_blank')"
                  style="
                    background: var(--surface);
                    border: 1px solid var(--border);
                    padding: 0.5rem 1rem;
                    border-radius: 6px;
                    font-size: 0.875rem;
                    cursor: pointer;
                    color: var(--primary);
                  "
                >
                  <i class="fas fa-external-link-alt"></i>
                  Manage Articles
                </button>
              </div>

              <div class="dynamic-list" id="referenceArticlesList">
                <div class="list-item">
                  <div class="list-item-header">
                    <span class="list-item-title">
                      <i class="fas fa-newspaper"></i>
                      Reference Article 1
                    </span>
                  </div>
                  <div class="form-grid">
                    <div class="form-group" style="grid-column: 1 / -1">
                      <label class="form-label">Select Article</label>
                      <select
                        class="form-select"
                        name="reference_articles[0]"
                        id="articleSelect0"
                      >
                        <option value="">
                          Choose an article from your database
                        </option>
                        <!-- Articles will be populated here -->
                      </select>
                    </div>
                  </div>
                  <div
                    id="selectedArticlePreview0"
                    style="
                      margin-top: 1rem;
                      padding: 1rem;
                      background: var(--background);
                      border-radius: 8px;
                      display: none;
                    "
                  >
                    <!-- Selected article preview will appear here -->
                  </div>
                </div>
              </div>

              <button
                type="button"
                class="add-item-btn"
                id="addReferenceArticleBtn"
              >
                <i class="fas fa-plus"></i>
                Add Another Reference Article
              </button>
            </div>

            <!-- Section 7: AI Smart Options -->
            <div class="form-section">
              <div class="section-header">
                <i class="fas fa-robot section-icon"></i>
                <span class="section-title">AI Smart Options</span>
              </div>
              <div class="form-grid">
                <div class="form-group">
                  <label class="form-label">Summary Language</label>
                  <select class="form-select" name="language_of_summary">
                    <option value="English">English</option>
                    <option value="Hindi">Hindi</option>
                    <option value="Tamil">Tamil</option>
                  </select>
                </div>
              </div>
              <div style="margin-top: 1rem">
                <div class="checkbox-group">
                  <input
                    type="checkbox"
                    id="generate_case_summary"
                    name="generate_case_summary"
                  />
                  <label for="generate_case_summary" class="checkbox-label"
                    >Auto-generate case summary using uploaded documents</label
                  >
                </div>
                <div class="checkbox-group">
                  <input
                    type="checkbox"
                    id="auto_extract_legal_sections"
                    name="auto_extract_legal_sections"
                  />
                  <label
                    for="auto_extract_legal_sections"
                    class="checkbox-label"
                    >AI scan and extract legal sections from text</label
                  >
                </div>
                <div class="checkbox-group">
                  <input
                    type="checkbox"
                    id="enable_ai_drafting"
                    name="enable_ai_drafting"
                  />
                  <label for="enable_ai_drafting" class="checkbox-label"
                    >Enable AI suggestions for notices & replies</label
                  >
                </div>
              </div>
            </div>

            <!-- Section 8: Team Assignment -->
            <div class="form-section">
              <div class="section-header">
                <i class="fas fa-user-friends section-icon"></i>
                <span class="section-title">Team Assignment</span>
              </div>

              <!-- Senior Advocate -->
              <div style="margin-bottom: 2rem">
                <h4
                  style="
                    font-size: 1rem;
                    font-weight: 600;
                    margin-bottom: 1rem;
                    color: var(--text-primary);
                  "
                >
                  <i class="fas fa-user-graduate"></i> Senior Advocate (Lead)
                </h4>
                <div class="list-item">
                  <div class="form-grid">
                    <div class="form-group">
                      <label class="form-label">Senior Advocate</label>
                      <select class="form-select" name="senior_advocate">
                        <option value="">Select Senior Advocate</option>
                        <option value="priya_sharma">
                          Priya Sharma - Senior Advocate (Criminal Law)
                        </option>
                        <option value="rajesh_kumar">
                          Rajesh Kumar - Senior Advocate (Corporate Law)
                        </option>
                        <option value="anil_verma">
                          Anil Verma - Senior Advocate (Civil Law)
                        </option>
                        <option value="kavita_singh">
                          Kavita Singh - Senior Advocate (Family Law)
                        </option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label class="form-label">Role</label>
                      <div style="padding: 0.75rem">
                        <span class="advocate-role-badge senior"
                          >Senior Advocate</span
                        >
                      </div>
                    </div>
                  </div>
                  <div class="checkbox-group">
                    <input
                      type="checkbox"
                      id="senior_can_edit"
                      name="senior_permissions[can_edit]"
                      checked
                    />
                    <label for="senior_can_edit" class="checkbox-label"
                      >Full case management access</label
                    >
                  </div>
                  <div class="checkbox-group">
                    <input
                      type="checkbox"
                      id="senior_can_sign"
                      name="senior_permissions[can_sign]"
                      checked
                    />
                    <label for="senior_can_sign" class="checkbox-label"
                      >Can sign documents and notices</label
                    >
                  </div>
                </div>
              </div>

              <!-- Junior Advocates -->
              <div>
                <h4
                  style="
                    font-size: 1rem;
                    font-weight: 600;
                    margin-bottom: 1rem;
                    color: var(--text-primary);
                  "
                >
                  <i class="fas fa-users"></i> Junior Advocates
                </h4>
                <div class="dynamic-list" id="juniorAdvocatesList">
                  <div class="list-item">
                    <div class="list-item-header">
                      <span class="list-item-title">
                        <i class="fas fa-user"></i>
                        Junior Advocate 1
                        <span class="advocate-role-badge junior">Junior</span>
                      </span>
                    </div>
                    <div class="form-grid">
                      <div class="form-group">
                        <label class="form-label">Junior Advocate</label>
                        <select
                          class="form-select"
                          name="junior_advocates[0][advocate_id]"
                        >
                          <option value="">Select Junior Advocate</option>
                          <option value="sunita_patel">
                            Sunita Patel - Advocate (Family Law)
                          </option>
                          <option value="amit_jain">
                            Amit Jain - Junior Advocate (Criminal Law)
                          </option>
                          <option value="neha_gupta">
                            Neha Gupta - Junior Advocate (Civil Law)
                          </option>
                          <option value="rohit_sharma">
                            Rohit Sharma - Junior Advocate (Corporate Law)
                          </option>
                          <option value="pooja_verma">
                            Pooja Verma - Junior Advocate (Tax Law)
                          </option>
                        </select>
                      </div>
                      <div class="form-group">
                        <label class="form-label">Primary Responsibility</label>
                        <select
                          class="form-select"
                          name="junior_advocates[0][responsibility]"
                        >
                          <option value="">Select Responsibility</option>
                          <option value="research">Legal Research</option>
                          <option value="documentation">Documentation</option>
                          <option value="client_interaction">
                            Client Interaction
                          </option>
                          <option value="court_appearance">
                            Court Appearance
                          </option>
                          <option value="case_preparation">
                            Case Preparation
                          </option>
                        </select>
                      </div>
                    </div>
                    <div style="margin-top: 1rem">
                      <div class="checkbox-group">
                        <input
                          type="checkbox"
                          name="junior_advocates[0][permissions][can_edit]"
                        />
                        <label class="checkbox-label"
                          >Can edit case details</label
                        >
                      </div>
                      <div class="checkbox-group">
                        <input
                          type="checkbox"
                          name="junior_advocates[0][permissions][can_upload_docs]"
                        />
                        <label class="checkbox-label"
                          >Can upload documents</label
                        >
                      </div>
                      <div class="checkbox-group">
                        <input
                          type="checkbox"
                          name="junior_advocates[0][permissions][can_view_notes]"
                        />
                        <label class="checkbox-label"
                          >Can view internal notes</label
                        >
                      </div>
                      <div class="checkbox-group">
                        <input
                          type="checkbox"
                          name="junior_advocates[0][permissions][can_appear]"
                        />
                        <label class="checkbox-label"
                          >Can appear in court</label
                        >
                      </div>
                    </div>
                  </div>
                </div>
                <button
                  type="button"
                  class="add-item-btn"
                  id="addJuniorAdvocateBtn"
                >
                  <i class="fas fa-plus"></i>
                  Add Another Junior Advocate
                </button>
              </div>
            </div>

            <!-- Section 9: Billing & Time Tracking -->
            <div class="form-section">
              <div class="section-header">
                <i class="fas fa-rupee-sign section-icon"></i>
                <span class="section-title">Billing & Time Tracking</span>
              </div>
              <div class="form-grid">
                <div class="form-group">
                  <label class="form-label">Billing Type</label>
                  <select class="form-select" name="billing_type">
                    <option value="">Select Billing Type</option>
                    <option value="Fixed">Fixed</option>
                    <option value="Hourly">Hourly</option>
                    <option value="Retainer">Retainer</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">Fee Agreed (INR)</label>
                  <input
                    type="number"
                    class="form-input"
                    name="fee_agreed"
                    placeholder="Amount in INR"
                  />
                </div>
                <div class="form-group">
                  <label class="form-label">Payment Status</label>
                  <select class="form-select" name="payment_status">
                    <option value="Pending">Pending</option>
                    <option value="Paid">Paid</option>
                    <option value="Partial">Partial</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">Invoice Due Date</label>
                  <input
                    type="date"
                    class="form-input"
                    name="client_invoice_due_date"
                  />
                </div>
              </div>
            </div>

            <!-- Section 10: Case History -->
            <div class="form-section">
              <div class="section-header">
                <i class="fas fa-history section-icon"></i>
                <span class="section-title">Case History</span>
              </div>
              <div class="form-group">
                <label class="form-label">Has Previous Case History?</label>
                <select class="form-select" name="has_history" id="hasHistory">
                  <option value="no">No</option>
                  <option value="yes">Yes</option>
                </select>
              </div>

              <div id="caseHistorySection" style="display: none">
                <!-- Previous Advocate Details -->
                <div
                  style="
                    background: var(--background);
                    padding: 1.5rem;
                    border-radius: 8px;
                    margin: 1.5rem 0;
                  "
                >
                  <h4
                    style="
                      color: var(--text-primary);
                      margin-bottom: 1rem;
                      font-size: 1rem;
                      font-weight: 600;
                    "
                  >
                    <i
                      class="fas fa-user-tie"
                      style="color: var(--primary); margin-right: 0.5rem"
                    ></i>
                    Previous Advocate Details
                  </h4>
                  <div class="form-grid">
                    <div class="form-group">
                      <label class="form-label">Previous Advocate Name</label>
                      <input
                        type="text"
                        class="form-input"
                        name="prev_advocate_name"
                        placeholder="Full name of previous lawyer"
                      />
                    </div>
                    <div class="form-group">
                      <label class="form-label"
                        >Advocate Registration No.</label
                      >
                      <input
                        type="text"
                        class="form-input"
                        name="prev_advocate_reg"
                        placeholder="Bar Council registration number"
                      />
                    </div>
                    <div class="form-group">
                      <label class="form-label">Law Firm Name</label>
                      <input
                        type="text"
                        class="form-input"
                        name="prev_law_firm"
                        placeholder="Name of previous law firm"
                      />
                    </div>
                    <div class="form-group">
                      <label class="form-label">Period Handled (From)</label>
                      <input
                        type="date"
                        class="form-input"
                        name="prev_period_from"
                      />
                    </div>
                    <div class="form-group">
                      <label class="form-label">Period Handled (To)</label>
                      <input
                        type="date"
                        class="form-input"
                        name="prev_period_to"
                      />
                    </div>
                    <div class="form-group">
                      <label class="form-label">Reason for Transfer</label>
                      <select class="form-select" name="transfer_reason">
                        <option value="">Select Reason</option>
                        <option value="Client Request">Client Request</option>
                        <option value="Advocate Unavailable">
                          Advocate Unavailable
                        </option>
                        <option value="Specialization Required">
                          Specialization Required
                        </option>
                        <option value="Cost Reasons">Cost Reasons</option>
                        <option value="Performance Issues">
                          Performance Issues
                        </option>
                        <option value="Other">Other</option>
                      </select>
                    </div>
                  </div>
                  <div class="form-group" style="margin-top: 1rem">
                    <label class="form-label">Previous Advocate Remarks</label>
                    <textarea
                      class="form-textarea"
                      name="prev_advocate_remarks"
                      placeholder="Any notes or additional information related to the handover"
                      style="min-height: 80px"
                    ></textarea>
                  </div>
                </div>

                <!-- Case History Entries -->
                <div
                  style="
                    background: var(--background);
                    padding: 1.5rem;
                    border-radius: 8px;
                    margin: 1.5rem 0;
                  "
                >
                  <h4
                    style="
                      color: var(--text-primary);
                      margin-bottom: 1rem;
                      font-size: 1rem;
                      font-weight: 600;
                    "
                  >
                    <i
                      class="fas fa-clock"
                      style="color: var(--primary); margin-right: 0.5rem"
                    ></i>
                    Historical Events
                  </h4>
                  <div id="historyEntries">
                    <div
                      class="history-entry"
                      style="
                        border: 1px solid var(--border);
                        padding: 1.5rem;
                        border-radius: 8px;
                        margin-bottom: 1rem;
                        background: var(--surface);
                      "
                    >
                      <div class="form-grid">
                        <div class="form-group">
                          <label class="form-label">Date of Event</label>
                          <input
                            type="date"
                            class="form-input"
                            name="history_date[]"
                          />
                        </div>
                        <div class="form-group">
                          <label class="form-label">Event Type</label>
                          <select
                            class="form-select"
                            name="history_event_type[]"
                          >
                            <option value="">Select Event Type</option>
                            <option value="Hearing">Hearing</option>
                            <option value="Filing">Filing</option>
                            <option value="Adjournment">Adjournment</option>
                            <option value="Evidence Submission">
                              Evidence Submission
                            </option>
                            <option value="Order Received">
                              Order Received
                            </option>
                            <option value="Notice Served">Notice Served</option>
                            <option value="Settlement Discussion">
                              Settlement Discussion
                            </option>
                            <option value="Appeal Filed">Appeal Filed</option>
                            <option value="Other">Other</option>
                          </select>
                        </div>
                        <div class="form-group">
                          <label class="form-label">Court Name</label>
                          <input
                            type="text"
                            class="form-input"
                            name="history_court[]"
                            placeholder="Name of the court"
                          />
                        </div>
                        <div class="form-group">
                          <label class="form-label">Judge Name</label>
                          <input
                            type="text"
                            class="form-input"
                            name="history_judge[]"
                            placeholder="Presiding judge"
                          />
                        </div>
                        <div class="form-group">
                          <label class="form-label">Next Hearing Date</label>
                          <input
                            type="date"
                            class="form-input"
                            name="history_next_hearing[]"
                          />
                        </div>
                        <div class="form-group">
                          <label class="form-label"
                            >Document Reference Type</label
                          >
                          <select class="form-select" name="history_doc_type[]">
                            <option value="">Select Document Type</option>
                            <option value="Order Copy">Order Copy</option>
                            <option value="Affidavit">Affidavit</option>
                            <option value="Submission Note">
                              Submission Note
                            </option>
                            <option value="Evidence Document">
                              Evidence Document
                            </option>
                            <option value="Notice">Notice</option>
                            <option value="Application">Application</option>
                            <option value="Other">Other</option>
                          </select>
                        </div>
                        <div class="form-group">
                          <label class="form-label">Appeal Status</label>
                          <select
                            class="form-select"
                            name="history_appeal_status[]"
                          >
                            <option value="Not Applicable">
                              Not Applicable
                            </option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                          </select>
                        </div>
                        <div class="form-group">
                          <label class="form-label">Notify Client?</label>
                          <select
                            class="form-select"
                            name="history_notify_client[]"
                          >
                            <option value="No">No</option>
                            <option value="Yes">Yes</option>
                          </select>
                        </div>
                      </div>
                      <div class="form-group" style="margin-top: 1rem">
                        <label class="form-label">Remarks / Summary</label>
                        <textarea
                          class="form-textarea"
                          name="history_remarks[]"
                          placeholder="Notes, updates, or brief explanation of the event"
                          style="min-height: 80px"
                        ></textarea>
                      </div>
                      <div class="form-group">
                        <label class="form-label"
                          >Order Summary / Decision</label
                        >
                        <textarea
                          class="form-textarea"
                          name="history_order_summary[]"
                          placeholder="Outcome of the hearing or order (if applicable)"
                          style="min-height: 60px"
                        ></textarea>
                      </div>
                      <div class="form-group">
                        <label class="form-label">Upload Documents</label>
                        <div class="file-upload">
                          <input
                            type="file"
                            name="history_documents[]"
                            multiple
                            accept=".pdf,.doc,.docx,.jpg,.png,.jpeg"
                            class="history-file-upload"
                          />
                          <div class="file-upload-btn">
                            <i class="fas fa-upload"></i>
                            Choose Files (PDF, DOC, DOCX, JPG, PNG)
                          </div>
                        </div>
                      </div>
                      <div style="text-align: right; margin-top: 1rem">
                        <button
                          type="button"
                          class="btn btn-secondary remove-history-entry"
                          style="padding: 0.5rem 1rem; font-size: 0.8rem"
                        >
                          <i class="fas fa-trash"></i> Remove Entry
                        </button>
                      </div>
                    </div>
                  </div>
                  <button
                    type="button"
                    id="addHistoryEntry"
                    class="btn btn-secondary"
                    style="margin-top: 1rem"
                  >
                    <i class="fas fa-plus"></i> Add Another History Entry
                  </button>
                </div>
              </div>
            </div>

            <!-- Section 11: Notes & Instructions -->
            <div class="form-section">
              <div class="section-header">
                <i class="fas fa-sticky-note section-icon"></i>
                <span class="section-title">Notes & Instructions</span>
              </div>
              <div class="form-grid">
                <div class="form-group" style="grid-column: 1 / -1">
                  <label class="form-label">Internal Notes</label>
                  <textarea
                    class="form-textarea"
                    name="internal_notes"
                    placeholder="Notes for advocate's eyes only"
                    style="min-height: 120px"
                  ></textarea>
                </div>
                <div class="form-group" style="grid-column: 1 / -1">
                  <label class="form-label">Client Instructions</label>
                  <textarea
                    class="form-textarea"
                    name="client_instructions"
                    placeholder="Instructions from client about how to proceed"
                    style="min-height: 120px"
                  ></textarea>
                </div>
              </div>
              <div class="checkbox-group">
                <input
                  type="checkbox"
                  id="sensitive_case"
                  name="sensitive_case"
                />
                <label for="sensitive_case" class="checkbox-label"
                  >Mark as sensitive case (restricted access)</label
                >
              </div>
            </div>
          </form>

          <!-- Form Actions -->
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" id="cancelBtn">
              <i class="fas fa-times"></i>
              Cancel
            </button>
            <button type="button" class="btn btn-secondary" id="saveDraftBtn">
              <i class="fas fa-file-alt"></i>
              Save as Draft
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              form="caseForm"
              id="submitBtn"
            >
              <i class="fas fa-save"></i>
              <span id="submitBtnText">Create Case</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Bottom Navigation -->
      <div class="bottom-nav">
        <div class="nav-items">
          <a href="home.html" class="nav-item">
            <i class="fas fa-home"></i>
            Home
          </a>
          <a href="team.html" class="nav-item">
            <i class="fas fa-users"></i>
            My Team
          </a>
          <a href="cases.html" class="nav-item active">
            <i class="fas fa-file-alt"></i>
            Cases
          </a>
          <a href="calendar.html" class="nav-item">
            <i class="fas fa-calendar"></i>
            Calendar
          </a>
          <a href="more.html" class="nav-item">
            <i class="fas fa-th"></i>
            More
          </a>
        </div>
      </div>
    </div>

    <script>
      $(document).ready(function () {
        // Check if in edit mode
        const urlParams = new URLSearchParams(window.location.search);
        const mode = urlParams.get("mode");
        const caseId = urlParams.get("id");
        const action = urlParams.get("action");

        if (mode === "edit") {
          if (action === "dispose") {
            // Switch to dispose mode
            $("#pageTitleText").text("Dispose Case");
            $("#pageIcon")
              .removeClass("fa-plus-circle")
              .addClass("fa-check-circle");
            $("#breadcrumbText").text("Dispose Case");
            $("#breadcrumbIcon")
              .removeClass("fa-plus")
              .addClass("fa-check-circle");
            $("#pageSubtitle").text(
              "Mark case as disposed and update final status",
            );
            $("#submitBtnText").text("Dispose Case");
            document.title = "Dispose Case - AI Advocates";

            // Load case data and set status to disposed
            loadCaseDataForEdit(caseId);

            // Auto-set status to disposed
            setTimeout(() => {
              $('select[name="status"]').val("Disposed").trigger("change");
              $('input[name="disposal_date"]').val(
                new Date().toISOString().split("T")[0],
              );
            }, 500);
          } else {
            // Switch to edit mode
            $("#pageTitleText").text("Edit Case");
            $("#pageIcon").removeClass("fa-plus-circle").addClass("fa-edit");
            $("#breadcrumbText").text("Edit Case");
            $("#breadcrumbIcon").removeClass("fa-plus").addClass("fa-edit");
            $("#pageSubtitle").text("Edit case details and information");
            $("#submitBtnText").text("Save Updates");
            document.title = "Edit Case - AI Advocates";

            // Load case data for editing
            loadCaseDataForEdit(caseId);
          }
        }

        // Navigation
        $(".nav-item").on("click", function (e) {
          const href = $(this).attr("href");
          if (href && href !== "#") {
            window.location.href = href;
          }
        });

        // Menu toggle
        $(".menu-toggle").on("click", function () {
          openSideMenu();
        });

        // Case history toggle
        $("#hasHistory").on("change", function () {
          if ($(this).val() === "yes") {
            $("#caseHistorySection").show();
          } else {
            $("#caseHistorySection").hide();
          }
        });

        // Add history entry
        $("#addHistoryEntry").on("click", function () {
          const historyEntryHtml = `
            <div class="history-entry" style="border: 1px solid var(--border); padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem; background: var(--surface);">
              <div class="form-grid">
                <div class="form-group">
                  <label class="form-label">Date of Event</label>
                  <input type="date" class="form-input" name="history_date[]">
                </div>
                <div class="form-group">
                  <label class="form-label">Event Type</label>
                  <select class="form-select" name="history_event_type[]">
                    <option value="">Select Event Type</option>
                    <option value="Hearing">Hearing</option>
                    <option value="Filing">Filing</option>
                    <option value="Adjournment">Adjournment</option>
                    <option value="Evidence Submission">Evidence Submission</option>
                    <option value="Order Received">Order Received</option>
                    <option value="Notice Served">Notice Served</option>
                    <option value="Settlement Discussion">Settlement Discussion</option>
                    <option value="Appeal Filed">Appeal Filed</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">Court Name</label>
                  <input type="text" class="form-input" name="history_court[]" placeholder="Name of the court">
                </div>
                <div class="form-group">
                  <label class="form-label">Judge Name</label>
                  <input type="text" class="form-input" name="history_judge[]" placeholder="Presiding judge">
                </div>
                <div class="form-group">
                  <label class="form-label">Next Hearing Date</label>
                  <input type="date" class="form-input" name="history_next_hearing[]">
                </div>
                <div class="form-group">
                  <label class="form-label">Document Reference Type</label>
                  <select class="form-select" name="history_doc_type[]">
                    <option value="">Select Document Type</option>
                    <option value="Order Copy">Order Copy</option>
                    <option value="Affidavit">Affidavit</option>
                    <option value="Submission Note">Submission Note</option>
                    <option value="Evidence Document">Evidence Document</option>
                    <option value="Notice">Notice</option>
                    <option value="Application">Application</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">Appeal Status</label>
                  <select class="form-select" name="history_appeal_status[]">
                    <option value="Not Applicable">Not Applicable</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">Notify Client?</label>
                  <select class="form-select" name="history_notify_client[]">
                    <option value="No">No</option>
                    <option value="Yes">Yes</option>
                  </select>
                </div>
              </div>
              <div class="form-group" style="margin-top: 1rem;">
                <label class="form-label">Remarks / Summary</label>
                <textarea class="form-textarea" name="history_remarks[]" placeholder="Notes, updates, or brief explanation of the event" style="min-height: 80px;"></textarea>
              </div>
              <div class="form-group">
                <label class="form-label">Order Summary / Decision</label>
                <textarea class="form-textarea" name="history_order_summary[]" placeholder="Outcome of the hearing or order (if applicable)" style="min-height: 60px;"></textarea>
              </div>
              <div class="form-group">
                <label class="form-label">Upload Documents</label>
                <div class="file-upload">
                  <input type="file" name="history_documents[]" multiple accept=".pdf,.doc,.docx,.jpg,.png,.jpeg" class="history-file-upload">
                  <div class="file-upload-btn">
                    <i class="fas fa-upload"></i>
                    Choose Files (PDF, DOC, DOCX, JPG, PNG)
                  </div>
                </div>
              </div>
              <div style="text-align: right; margin-top: 1rem;">
                <button type="button" class="btn btn-secondary remove-history-entry" style="padding: 0.5rem 1rem; font-size: 0.8rem;">
                  <i class="fas fa-trash"></i> Remove Entry
                </button>
              </div>
            </div>
          `;
          $("#historyEntries").append(historyEntryHtml);
        });

        // Remove history entry
        $(document).on("click", ".remove-history-entry", function () {
          if ($("#historyEntries .history-entry").length > 1) {
            $(this).closest(".history-entry").remove();
          } else {
            alert("At least one history entry is required.");
          }
        });

        // History file upload handling
        $(document).on("change", ".history-file-upload", function () {
          const files = this.files;
          if (files.length > 0) {
            $(this)
              .siblings(".file-upload-btn")
              .html(
                `<i class="fas fa-check"></i> ${files.length} file(s) selected`,
              );
          } else {
            $(this)
              .siblings(".file-upload-btn")
              .html(
                `<i class="fas fa-upload"></i> Choose Files (PDF, DOC, DOCX, JPG, PNG)`,
              );
          }
        });

        // Dynamic Petitioners
        let petitionerCount = 1;
        $("#addPetitionerBtn").on("click", function () {
          const petitionerHtml = `
            <div class="list-item">
              <div class="list-item-header">
                <span class="list-item-title">
                  <i class="fas fa-user"></i>
                  Petitioner ${petitionerCount + 1}
                </span>
                <button type="button" class="remove-item-btn" onclick="removeListItem(this)">
                  <i class="fas fa-times"></i>
                  Remove
                </button>
              </div>
              <div class="form-grid">
                <div class="form-group">
                  <label class="form-label">Name <span class="required">*</span></label>
                  <input type="text" class="form-input" name="petitioners[${petitionerCount}][name]" required>
                </div>
                <div class="form-group">
                  <label class="form-label">Phone</label>
                  <input type="tel" class="form-input" name="petitioners[${petitionerCount}][phone]">
                </div>
                <div class="form-group">
                  <label class="form-label">Email</label>
                  <input type="email" class="form-input" name="petitioners[${petitionerCount}][email]">
                </div>
                <div class="form-group">
                  <label class="form-label">Type</label>
                  <select class="form-select" name="petitioners[${petitionerCount}][type]">
                    <option value="Individual">Individual</option>
                    <option value="Company">Company</option>
                    <option value="Organization">Organization</option>
                    <option value="Government">Government</option>
                  </select>
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                  <label class="form-label">Address</label>
                  <textarea class="form-textarea" name="petitioners[${petitionerCount}][address]" placeholder="Complete address"></textarea>
                </div>
              </div>
            </div>
          `;
          $("#petitionersList").append(petitionerHtml);
          petitionerCount++;
        });

        // Dynamic Respondents
        let respondentCount = 1;
        $("#addRespondentBtn").on("click", function () {
          const respondentHtml = `
            <div class="list-item">
              <div class="list-item-header">
                <span class="list-item-title">
                  <i class="fas fa-user-tie"></i>
                  Respondent ${respondentCount + 1}
                </span>
                <button type="button" class="remove-item-btn" onclick="removeListItem(this)">
                  <i class="fas fa-times"></i>
                  Remove
                </button>
              </div>
              <div class="form-grid">
                <div class="form-group">
                  <label class="form-label">Name <span class="required">*</span></label>
                  <input type="text" class="form-input" name="respondents[${respondentCount}][name]" required>
                </div>
                <div class="form-group">
                  <label class="form-label">Phone</label>
                  <input type="tel" class="form-input" name="respondents[${respondentCount}][phone]">
                </div>
                <div class="form-group">
                  <label class="form-label">Email</label>
                  <input type="email" class="form-input" name="respondents[${respondentCount}][email]">
                </div>
                <div class="form-group">
                  <label class="form-label">Type</label>
                  <select class="form-select" name="respondents[${respondentCount}][type]">
                    <option value="Individual">Individual</option>
                    <option value="Company">Company</option>
                    <option value="Organization">Organization</option>
                    <option value="Government">Government</option>
                  </select>
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                  <label class="form-label">Address</label>
                  <textarea class="form-textarea" name="respondents[${respondentCount}][address]" placeholder="Complete address"></textarea>
                </div>
              </div>
            </div>
          `;
          $("#respondentsList").append(respondentHtml);
          respondentCount++;
        });

        // Dynamic Junior Advocates
        let juniorAdvocateCount = 1;
        $("#addJuniorAdvocateBtn").on("click", function () {
          const juniorAdvocateHtml = `
            <div class="list-item">
              <div class="list-item-header">
                <span class="list-item-title">
                  <i class="fas fa-user"></i>
                  Junior Advocate ${juniorAdvocateCount + 1}
                  <span class="advocate-role-badge junior">Junior</span>
                </span>
                <button type="button" class="remove-item-btn" onclick="removeListItem(this)">
                  <i class="fas fa-times"></i>
                  Remove
                </button>
              </div>
              <div class="form-grid">
                <div class="form-group">
                  <label class="form-label">Junior Advocate</label>
                  <select class="form-select" name="junior_advocates[${juniorAdvocateCount}][advocate_id]">
                    <option value="">Select Junior Advocate</option>
                    <option value="sunita_patel">Sunita Patel - Advocate (Family Law)</option>
                    <option value="amit_jain">Amit Jain - Junior Advocate (Criminal Law)</option>
                    <option value="neha_gupta">Neha Gupta - Junior Advocate (Civil Law)</option>
                    <option value="rohit_sharma">Rohit Sharma - Junior Advocate (Corporate Law)</option>
                    <option value="pooja_verma">Pooja Verma - Junior Advocate (Tax Law)</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">Primary Responsibility</label>
                  <select class="form-select" name="junior_advocates[${juniorAdvocateCount}][responsibility]">
                    <option value="">Select Responsibility</option>
                    <option value="research">Legal Research</option>
                    <option value="documentation">Documentation</option>
                    <option value="client_interaction">Client Interaction</option>
                    <option value="court_appearance">Court Appearance</option>
                    <option value="case_preparation">Case Preparation</option>
                  </select>
                </div>
              </div>
              <div style="margin-top: 1rem;">
                <div class="checkbox-group">
                  <input type="checkbox" name="junior_advocates[${juniorAdvocateCount}][permissions][can_edit]" id="junior_edit_${juniorAdvocateCount}">
                  <label for="junior_edit_${juniorAdvocateCount}" class="checkbox-label">Can edit case details</label>
                </div>
                <div class="checkbox-group">
                  <input type="checkbox" name="junior_advocates[${juniorAdvocateCount}][permissions][can_upload_docs]" id="junior_upload_${juniorAdvocateCount}">
                  <label for="junior_upload_${juniorAdvocateCount}" class="checkbox-label">Can upload documents</label>
                </div>
                <div class="checkbox-group">
                  <input type="checkbox" name="junior_advocates[${juniorAdvocateCount}][permissions][can_view_notes]" id="junior_view_${juniorAdvocateCount}">
                  <label for="junior_view_${juniorAdvocateCount}" class="checkbox-label">Can view internal notes</label>
                </div>
                <div class="checkbox-group">
                  <input type="checkbox" name="junior_advocates[${juniorAdvocateCount}][permissions][can_appear]" id="junior_appear_${juniorAdvocateCount}">
                  <label for="junior_appear_${juniorAdvocateCount}" class="checkbox-label">Can appear in court</label>
                </div>
              </div>
            </div>
          `;
          $("#juniorAdvocatesList").append(juniorAdvocateHtml);
          juniorAdvocateCount++;
        });

        // Enhanced File upload handling
        $("#documentUpload").on("change", function () {
          const files = this.files;
          const filesList = $("#uploadedDocumentsList");

          if (files.length > 0) {
            // Update button text
            $(this)
              .siblings(".file-upload-btn")
              .html(
                `<i class="fas fa-check"></i> ${files.length} file(s) selected`,
              );

            // Clear previous list
            filesList.empty();

            // Add each file with categorization
            for (let i = 0; i < files.length; i++) {
              const file = files[i];
              const fileItem = `
                <div class="document-item" data-file-index="${i}">
                  <div class="document-info">
                    <i class="fas fa-file"></i>
                    <span style="font-weight: 500;">${file.name}</span>
                    <small style="color: var(--text-muted);">(${formatFileSize(file.size)})</small>
                    <select class="document-type-select" name="document_types[${i}]">
                      <option value="">Select Type</option>
                      <option value="FIR">FIR</option>
                      <option value="Petition">Petition</option>
                      <option value="Evidence">Evidence</option>
                      <option value="Notice">Notice</option>
                      <option value="Order">Order/Judgment</option>
                      <option value="Affidavit">Affidavit</option>
                      <option value="Contract">Contract</option>
                      <option value="Identity">Identity Proof</option>
                      <option value="Financial">Financial Document</option>
                      <option value="Other">Other</option>
                    </select>
                  </div>
                  <button type="button" class="remove-item-btn" onclick="removeDocument(this, ${i})">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              `;
              filesList.append(fileItem);
            }
          } else {
            $(this)
              .siblings(".file-upload-btn")
              .html(
                `<i class="fas fa-upload"></i> Choose Files (PDF, DOC, DOCX, JPG, PNG)`,
              );
            filesList.empty();
          }
        });

        // Sample articles data (same as articles.html)
        const articlesDatabase = [
          {
            id: 1,
            title: "Supreme Court Judgment on Bail Rights in Criminal Cases",
            type: "Case Law",
            url: "https://www.example.com/sc-bail-judgment",
            author: "Supreme Court of India",
            date: "2024-01-15",
            summary:
              "A landmark judgment establishing new precedents for bail applications in criminal cases, emphasizing the right to liberty and due process.",
            tags: ["bail", "criminal law", "supreme court", "precedent"],
          },
          {
            id: 2,
            title: "New Amendments to Civil Procedure Code 2024",
            type: "Legal Article",
            url: "https://www.example.com/cpc-amendments",
            author: "Bar & Bench",
            date: "2024-02-01",
            summary:
              "Comprehensive analysis of the latest amendments to the Civil Procedure Code and their impact on civil litigation.",
            tags: ["civil procedure", "amendments", "litigation"],
          },
          {
            id: 3,
            title:
              "Digital Evidence in Indian Courts: Guidelines and Best Practices",
            type: "Academic Paper",
            url: "https://www.example.com/digital-evidence-guidelines",
            author: "National Law University",
            date: "2024-01-20",
            summary:
              "Research paper on the admissibility and handling of digital evidence in Indian courts with practical guidelines for practitioners.",
            tags: ["digital evidence", "cybercrime", "evidence act"],
          },
        ];

        // Populate article dropdowns
        function populateArticleDropdown(selectElement) {
          const currentOptions = selectElement.innerHTML;
          const baseOption =
            '<option value="">Choose an article from your database</option>';

          const articleOptions = articlesDatabase
            .map(
              (article) =>
                `<option value="${article.id}" data-article='${JSON.stringify(article)}'>${article.title} (${article.type})</option>`,
            )
            .join("");

          selectElement.innerHTML = baseOption + articleOptions;
        }

        // Handle article selection
        function handleArticleSelection(selectElement, previewElement) {
          const selectedOption =
            selectElement.options[selectElement.selectedIndex];

          if (selectedOption.value && selectedOption.dataset.article) {
            const article = JSON.parse(selectedOption.dataset.article);

            const previewHtml = `
              <div style="display: flex; align-items: flex-start; gap: 1rem;">
                <div style="flex: 1;">
                  <h4 style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--text-primary);">${article.title}</h4>
                  <div style="display: flex; gap: 1rem; margin-bottom: 0.5rem; font-size: 0.8rem; color: var(--text-secondary);">
                    <span class="article-type" style="padding: 0.25rem 0.5rem; border-radius: 12px; background: rgba(79, 70, 229, 0.1); color: var(--primary);">${article.type}</span>
                    ${article.author ? `<span><i class="fas fa-user"></i> ${article.author}</span>` : ""}
                    ${article.date ? `<span><i class="fas fa-calendar"></i> ${formatDate(article.date)}</span>` : ""}
                  </div>
                  ${article.summary ? `<p style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 0.5rem;">${article.summary}</p>` : ""}
                  ${article.url ? `<p style="font-size: 0.8rem;"><a href="${article.url}" target="_blank" style="color: var(--primary); text-decoration: none;"><i class="fas fa-external-link-alt"></i> View Article</a></p>` : ""}
                </div>
              </div>
            `;

            previewElement.innerHTML = previewHtml;
            previewElement.style.display = "block";
          } else {
            previewElement.style.display = "none";
          }
        }

        // Dynamic Reference Articles
        let referenceArticleCount = 1;

        // Populate initial dropdown
        populateArticleDropdown(document.getElementById("articleSelect0"));

        // Handle initial dropdown change
        $(document).on("change", "#articleSelect0", function () {
          handleArticleSelection(
            this,
            document.getElementById("selectedArticlePreview0"),
          );
        });

        $("#addReferenceArticleBtn").on("click", function () {
          const articleHtml = `
            <div class="list-item">
              <div class="list-item-header">
                <span class="list-item-title">
                  <i class="fas fa-newspaper"></i>
                  Reference Article ${referenceArticleCount + 1}
                </span>
                <button type="button" class="remove-item-btn" onclick="removeListItem(this)">
                  <i class="fas fa-times"></i>
                  Remove
                </button>
              </div>
              <div class="form-grid">
                <div class="form-group" style="grid-column: 1 / -1;">
                  <label class="form-label">Select Article</label>
                  <select class="form-select" name="reference_articles[${referenceArticleCount}]" id="articleSelect${referenceArticleCount}">
                    <option value="">Choose an article from your database</option>
                  </select>
                </div>
              </div>
              <div id="selectedArticlePreview${referenceArticleCount}" style="margin-top: 1rem; padding: 1rem; background: var(--background); border-radius: 8px; display: none;">
                <!-- Selected article preview will appear here -->
              </div>
            </div>
          `;
          $("#referenceArticlesList").append(articleHtml);

          // Populate the new dropdown
          populateArticleDropdown(
            document.getElementById(`articleSelect${referenceArticleCount}`),
          );

          // Add event listener for the new dropdown
          $(`#articleSelect${referenceArticleCount}`).on("change", function () {
            handleArticleSelection(
              this,
              document.getElementById(
                `selectedArticlePreview${referenceArticleCount}`,
              ),
            );
          });

          referenceArticleCount++;
        });

        // Cancel button
        $("#cancelBtn").on("click", function () {
          if (
            confirm(
              "Are you sure you want to cancel? All entered data will be lost.",
            )
          ) {
            window.location.href = "cases.html";
          }
        });

        // Form submission
        $("#caseForm").on("submit", function (e) {
          e.preventDefault();

          // Collect form data
          const formData = new FormData(this);
          const caseData = {};

          // Convert FormData to object
          for (let [key, value] of formData.entries()) {
            if (caseData[key]) {
              if (Array.isArray(caseData[key])) {
                caseData[key].push(value);
              } else {
                caseData[key] = [caseData[key], value];
              }
            } else {
              caseData[key] = value;
            }
          }

          // Add metadata
          caseData.created_by = "current_advocate_id";
          caseData.created_on = new Date().toISOString();
          caseData.case_id = generateCaseId();

          // Here you would normally send the data to your backend
          console.log("Case Data:", caseData);

          // Show success message
          const isEdit = mode === "edit";
          const isDispose = action === "dispose";

          if (isDispose) {
            alert(
              "Case disposed successfully! The case has been moved to the disposed tab.",
            );
            window.location.href = "cases.html";
          } else {
            alert(
              isEdit
                ? "Case updated successfully!"
                : "Case created successfully!",
            );

            // Redirect to appropriate page
            if (isEdit && caseId) {
              window.location.href = `case-details.html?id=${caseId}`;
            } else {
              window.location.href = "cases.html";
            }
          }
        });

        // Logout functionality
        $(".fa-sign-out-alt")
          .parent()
          .on("click", function () {
            logoutFromApp();
          });
      });

      // Side menu functions
      function openSideMenu() {
        $("#sideMenu").addClass("open");
        $("#sideMenuOverlay").addClass("show");
      }

      function closeSideMenu() {
        $("#sideMenu").removeClass("open");
        $("#sideMenuOverlay").removeClass("show");
      }

      function logoutFromApp() {
        window.location.href = "index.html";
      }

      // Generate unique case ID
      function generateCaseId() {
        return (
          "CASE_" +
          Date.now() +
          "_" +
          Math.random().toString(36).substr(2, 5).toUpperCase()
        );
      }

      // Close menu when clicking overlay
      $("#sideMenuOverlay").on("click", function () {
        closeSideMenu();
      });

      // Utility functions
      function removeListItem(button) {
        $(button).closest(".list-item").remove();
      }

      function removeDocument(button, index) {
        $(button).closest(".document-item").remove();
        // Note: In a real implementation, you'd also need to update the file input
        // This is a simplified version for demonstration
      }

      function formatFileSize(bytes) {
        if (bytes === 0) return "0 Bytes";
        const k = 1024;
        const sizes = ["Bytes", "KB", "MB", "GB"];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
      }

      function formatDate(dateString) {
        if (!dateString) return "";
        const date = new Date(dateString);
        return date.toLocaleDateString("en-IN", {
          year: "numeric",
          month: "short",
          day: "numeric",
        });
      }

      // Load case data for editing
      function loadCaseDataForEdit(caseId) {
        // Sample case data - in reality this would come from your backend
        const casesData = {
          1: {
            case_title: "State vs. John Doe",
            case_type: "Criminal",
            court_name: "District Court, Delhi",
            judge_name: "Hon'ble Justice A.K. Sharma",
            case_number: "CC/1234/2024",
            filing_date: "2023-12-20",
            client_name: "John Doe",
            client_type: "Individual",
            client_phone: "+91 9876543210",
            client_email: "johndoe@email.com",
            ipc_sections: "420, 406, 34",
            acts: "IPC",
            next_hearing_date: "2024-01-15",
            status: "Active",
            case_summary:
              "The case involves allegations of cheating and criminal breach of trust against the accused John Doe.",
            senior_advocate: "priya_sharma",
            junior_advocate: "amit_jain",
            fee_agreed: "250000",
            payment_status: "Partial",
            internal_notes:
              "Client is cooperative. Need to prepare strong bail application.",
          },
          2: {
            case_title: "Smith Property Dispute",
            case_type: "Civil",
            court_name: "High Court, Delhi",
            judge_name: "Hon'ble Justice B.K. Patel",
            case_number: "CS/5678/2024",
            filing_date: "2023-12-15",
            client_name: "Mr. Smith",
            client_type: "Individual",
            client_phone: "+91 9876543211",
            client_email: "smith@email.com",
            ipc_sections: "",
            acts: "Transfer of Property Act",
            next_hearing_date: "2024-01-18",
            status: "Pending",
            case_summary:
              "Property dispute regarding ownership and possession rights.",
            senior_advocate: "rajesh_kumar",
            junior_advocate: "neha_gupta",
            fee_agreed: "150000",
            payment_status: "Paid",
            internal_notes: "Strong documentary evidence available.",
          },
        };

        const caseData = casesData[caseId] || casesData["1"];

        // Populate form fields with case data
        $('input[name="case_title"]').val(caseData.case_title);
        $('select[name="case_type"]').val(caseData.case_type);
        $('input[name="court_name"]').val(caseData.court_name);
        $('input[name="judge_name"]').val(caseData.judge_name);
        $('input[name="case_number"]').val(caseData.case_number);
        $('input[name="filing_date"]').val(caseData.filing_date);
        $('input[name="client_name"]').val(caseData.client_name);
        $('select[name="client_type"]').val(caseData.client_type);
        $('input[name="client_phone"]').val(caseData.client_phone);
        $('input[name="client_email"]').val(caseData.client_email);
        $('input[name="ipc_sections"]').val(caseData.ipc_sections);
        $('input[name="acts"]').val(caseData.acts);
        $('input[name="next_hearing_date"]').val(caseData.next_hearing_date);
        $('select[name="status"]').val(caseData.status);
        $('textarea[name="case_summary"]').val(caseData.case_summary);
        $('select[name="senior_advocate"]').val(caseData.senior_advocate);
        $('select[name="junior_advocate"]').val(caseData.junior_advocate);
        $('input[name="fee_agreed"]').val(caseData.fee_agreed);
        $('select[name="payment_status"]').val(caseData.payment_status);
        $('textarea[name="internal_notes"]').val(caseData.internal_notes);
      }

      // Case Creation and Notification Functions
      function setupCaseCreation() {
        // Handle form submission
        $("#caseForm").on("submit", function (e) {
          e.preventDefault();
          createCase();
        });
      }

      function createCase() {
        const $submitBtn = $("#submitBtn");

        // Validate required fields
        if (!validateForm()) {
          return;
        }

        // Show loading state
        $submitBtn.addClass("loading");
        $submitBtn.find("#submitBtnText").text("Creating Case...");

        // Simulate API call delay
        setTimeout(() => {
          try {
            // Collect form data
            const caseData = collectFormData();

            // Generate case ID and additional metadata
            const newCase = {
              ...caseData,
              id: generateCaseId(),
              created_at: new Date().toISOString(),
              created_by: "current_user_id", // In real app, get from auth
              last_updated: new Date().toISOString(),
              status: caseData.status || "Active",
            };

            // Save case to localStorage (simulating database save)
            saveCase(newCase);

            // Reset submit button
            $submitBtn.removeClass("loading");
            $submitBtn.find("#submitBtnText").text("Create Case");

            // Store success message for display on cases page
            localStorage.setItem(
              "case_creation_success",
              JSON.stringify({
                message: "Case created successfully!",
                caseId: newCase.id,
                timestamp: Date.now(),
              }),
            );

            // Redirect to cases page
            window.location.href = "cases.html";
          } catch (error) {
            console.error("Failed to create case:", error);
            showErrorNotification("Failed to create case. Please try again.");

            // Reset submit button
            $submitBtn.removeClass("loading");
            $submitBtn.find("#submitBtnText").text("Create Case");
          }
        }, 2000); // 2 second delay to show loading state
      }

      function validateForm() {
        let isValid = true;
        const requiredFields = [
          "case_title",
          "case_type",
          "court_name",
          "filing_date",
          "petitioners[0][name]",
          "respondents[0][name]",
        ];

        // Reset previous validation states
        $(".form-input, .form-select").removeClass("error");

        requiredFields.forEach((fieldName) => {
          const $field = $(`[name="${fieldName}"]`);
          if (!$field.val() || $field.val().trim() === "") {
            $field.addClass("error");
            isValid = false;
          }
        });

        if (!isValid) {
          alert("Please fill in all required fields marked with *");
          // Scroll to first error field
          $(".form-input.error, .form-select.error")
            .first()[0]
            ?.scrollIntoView({
              behavior: "smooth",
              block: "center",
            });
        }

        return isValid;
      }

      function generateCaseId() {
        const timestamp = Date.now();
        const random = Math.random().toString(36).substr(2, 5).toUpperCase();
        return `CASE_${timestamp}_${random}`;
      }

      function saveCase(caseData) {
        // Get existing cases from localStorage
        let existingCases = JSON.parse(
          localStorage.getItem("cases_list") || "[]",
        );

        // Add new case to the beginning of the list
        existingCases.unshift(caseData);

        // Save back to localStorage
        localStorage.setItem("cases_list", JSON.stringify(existingCases));

        // In a real application, you would also send to server
        // return fetch('/api/cases', {
        //   method: 'POST',
        //   headers: { 'Content-Type': 'application/json' },
        //   body: JSON.stringify(caseData)
        // });
      }

      function resetForm() {
        // Reset all form fields
        $("#caseForm")[0].reset();

        // Reset any dynamic lists
        resetDynamicLists();

        // Reset file uploads
        $("#uploadedDocumentsList").empty();
        $(".file-upload-btn").html(
          '<i class="fas fa-upload"></i> Choose Files (PDF, DOC, DOCX, JPG, PNG)',
        );
      }

      function resetDynamicLists() {
        // Reset petitioners to just one
        $("#petitionersList .list-item:not(:first)").remove();
        $("#petitionersList .list-item:first input").val("");

        // Reset respondents to just one
        $("#respondentsList .list-item:not(:first)").remove();
        $("#respondentsList .list-item:first input").val("");

        // Reset other dynamic lists
        $("#juniorAdvocatesList").empty();
        $("#articlesList").empty();
      }

      function showSuccessNotification(caseData) {
        const $overlay = $("#notificationOverlay");
        const $notification = $("#successNotification");
        const $message = $("#successMessage");

        // Update message with case details
        $message.html(`
          Your case <strong>"${caseData.case_title}"</strong> has been created successfully.<br>
          Case ID: <strong>${caseData.id}</strong><br>
          You can now view it in your cases list.
        `);

        // Show notification
        $overlay.addClass("show");
        $notification.addClass("show");
      }

      function showErrorNotification(message) {
        alert(`Error: ${message}`);
      }

      function closeNotification() {
        const $overlay = $("#notificationOverlay");
        const $notification = $("#successNotification");

        $notification.removeClass("show");
        $overlay.removeClass("show");
      }

      function viewCaseList() {
        // Close notification first
        closeNotification();

        // Navigate to cases page after a brief delay
        setTimeout(() => {
          window.location.href = "cases.html";
        }, 300);
      }

      // Add error styling for validation
      function addValidationStyles() {
        const style = `
          .form-input.error,
          .form-select.error {
            border-color: var(--error) !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
          }
        `;

        const styleSheet = document.createElement("style");
        styleSheet.textContent = style;
        document.head.appendChild(styleSheet);
      }

      // Initialize case creation functionality
      $(document).ready(function () {
        setTimeout(() => {
          setupCaseCreation();
          addValidationStyles();
        }, 1000);
      });

      // Close notification when clicking overlay
      $("#notificationOverlay").on("click", function () {
        closeNotification();
      });

      // Save as Draft button event handler
      $("#saveDraftBtn").on("click", function () {
        saveDraft();
      });

      // Collect form data function
      function collectFormData() {
        const formData = new FormData(document.getElementById("caseForm"));
        const caseData = {};

        // Convert FormData to object
        for (let [key, value] of formData.entries()) {
          if (caseData[key]) {
            if (Array.isArray(caseData[key])) {
              caseData[key].push(value);
            } else {
              caseData[key] = [caseData[key], value];
            }
          } else {
            caseData[key] = value;
          }
        }

        return caseData;
      }

      // Save as Draft functionality
      function saveDraft() {
        const $saveDraftBtn = $("#saveDraftBtn");

        // Show loading state
        $saveDraftBtn.addClass("loading");
        $saveDraftBtn.html(
          '<i class="fas fa-spinner fa-spin"></i> Saving Draft...',
        );

        try {
          // Collect form data
          const draftData = collectFormData();

          // Add draft metadata
          const draft = {
            ...draftData,
            id: "DRAFT_" + Date.now(),
            created_at: new Date().toISOString(),
            last_updated: new Date().toISOString(),
            is_draft: true,
            draft_name: draftData.case_title || "Untitled Draft",
          };

          // Save draft to localStorage
          saveDraftToStorage(draft);

          // Show success feedback
          setTimeout(() => {
            $saveDraftBtn.removeClass("loading");
            $saveDraftBtn.html('<i class="fas fa-check"></i> Draft Saved');
            $saveDraftBtn.addClass("btn-success").removeClass("btn-secondary");

            // Reset button after 2 seconds
            setTimeout(() => {
              $saveDraftBtn
                .removeClass("btn-success")
                .addClass("btn-secondary");
              $saveDraftBtn.html(
                '<i class="fas fa-file-alt"></i> Save as Draft',
              );
            }, 2000);
          }, 1000);
        } catch (error) {
          console.error("Failed to save draft:", error);
          alert("Failed to save draft. Please try again.");

          // Reset button
          $saveDraftBtn.removeClass("loading");
          $saveDraftBtn.html('<i class="fas fa-file-alt"></i> Save as Draft');
        }
      }

      function saveDraftToStorage(draftData) {
        // Get existing drafts from localStorage
        let existingDrafts = JSON.parse(
          localStorage.getItem("case_drafts") || "[]",
        );

        // Check if this is an update to an existing draft
        const existingIndex = existingDrafts.findIndex(
          (draft) =>
            draft.draft_name === draftData.draft_name && draft.is_draft,
        );

        if (existingIndex !== -1) {
          // Update existing draft
          existingDrafts[existingIndex] = draftData;
        } else {
          // Add new draft to the beginning of the list
          existingDrafts.unshift(draftData);
        }

        // Limit to 10 drafts to prevent storage overflow
        if (existingDrafts.length > 10) {
          existingDrafts = existingDrafts.slice(0, 10);
        }

        // Save back to localStorage
        localStorage.setItem("case_drafts", JSON.stringify(existingDrafts));
      }
    </script>
  </body>
</html>
